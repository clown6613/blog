---
import { format } from 'date-fns';
import { ja } from 'date-fns/locale';
import { CATEGORIES } from '../constants/categories';
import { calculateReadingTime } from '../utils/readingTime';
import type { BlogPost } from '../types';

interface Props {
  post: BlogPost;
}

const { post } = Astro.props;
const base = import.meta.env.BASE_URL;
const category = CATEGORIES[post.data.category];
const formattedDate = format(post.data.pubDate, 'yyyyÂπ¥MMÊúàddÊó•', { locale: ja });
const readingTime = calculateReadingTime(post.body);
---

<article class="bg-white dark:bg-slate-800 rounded-lg shadow-md hover:shadow-xl hover:border-primary dark:hover:border-primary-light transition-all p-6 border-2 border-gray-200 dark:border-slate-700">
  <div class="flex items-center gap-2 mb-3">
    <span class="text-2xl px-2 py-1 bg-primary/10 rounded">{category.icon}</span>
    <span class="text-sm font-semibold text-primary">{category.name}</span>
    <span class="text-sm text-gray-400 dark:text-gray-500">‚Ä¢</span>
    <time class="text-sm text-gray-600 dark:text-gray-400">{formattedDate}</time>
    <span class="text-sm text-gray-400 dark:text-gray-500">‚Ä¢</span>
    <span class="text-sm text-gray-600 dark:text-gray-400">üìñ Á¥Ñ{readingTime}ÂàÜ</span>
  </div>

  <h2 class="text-2xl font-bold mb-3 text-gray-900 dark:text-primary-light hover:text-primary dark:hover:text-white transition-colors">
    <a href={`${base}/posts/${post.id}`}>
      {post.data.title}
    </a>
  </h2>

  {post.data.description && (
    <p class="text-gray-700 dark:text-gray-300 mb-4 line-clamp-3">
      {post.data.description}
    </p>
  )}

  {post.data.tags && post.data.tags.length > 0 && (
    <div class="flex flex-wrap gap-2 mt-4">
      {post.data.tags.map(tag => (
        <span class="px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 text-sm rounded-full">
          #{tag}
        </span>
      ))}
    </div>
  )}

  <div class="mt-4">
    <a
      href={`${base}/posts/${post.id}`}
      class="inline-flex items-center px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark font-medium transition-colors"
    >
      Á∂ö„Åç„ÇíË™≠„ÇÄ ‚Üí
    </a>
  </div>
</article>
