---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import PostCard from '../components/PostCard.astro';
import Search from '../components/Search.astro';

// 公開記事のみ取得して日付でソート
const posts = (await getCollection('posts', ({ data }) => {
  return data.published === true;
})).sort((a, b) =>
  b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const { base } = import.meta.env;
---

<BaseLayout title="My Blog - ホーム">
  <Header slot="header" />

  <div class="space-y-8">
    <div class="text-center mb-12">
      <h1 class="text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-4">
        技術と趣味のブログ
      </h1>
      <p class="text-lg text-gray-600 dark:text-gray-400">
        プログラミング、開発、趣味について書いています
      </p>
    </div>

    <!-- 検索UI -->
    <Search />

    <!-- カテゴリフィルター -->
    <div class="flex justify-center gap-4 mb-8">
      <a
        href={`${base}/category/tech`}
        class="px-6 py-3 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-lg hover:border-primary hover:text-primary transition-all font-medium flex items-center gap-2"
      >
        <span>💻</span>
        <span>技術</span>
      </a>
      <a
        href={`${base}/category/hobby`}
        class="px-6 py-3 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-lg hover:border-primary hover:text-primary transition-all font-medium flex items-center gap-2"
      >
        <span>🎨</span>
        <span>趣味</span>
      </a>
    </div>

    {posts.length === 0 ? (
      <div class="text-center py-12">
        <p class="text-gray-600 dark:text-gray-400 text-lg">
          まだ記事がありません。最初の記事をお楽しみに！
        </p>
      </div>
    ) : (
      <div class="grid gap-6 md:gap-8">
        {posts.map(post => (
          <PostCard post={post} />
        ))}
      </div>
    )}
  </div>

  <Footer slot="footer" />
</BaseLayout>
